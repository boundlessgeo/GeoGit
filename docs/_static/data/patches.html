<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, maximum-scale=1">
  
  <title>Creating and applying patches &mdash; GeoGig 0.11 User Manual</title>
  <link rel="stylesheet" href="../_static/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="../_static/print.css" type="text/css" media="print" /> 
  <!--[if IE]>
  <link rel="stylesheet" href="../_static/blueprint/ie.css" type="text/css" media="screen, projection" />
  <![endif]-->
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/offcanvas.css" type="text/css" />
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.11',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html'
    };
  </script>
      <link rel="top" title="GeoGig 0.11 User Manual" href="../index.html" />
      <link rel="up" title="Data and commits" href="index.html" />
      <link rel="next" title="Cherry-picking commits" href="picking.html" />
      <link rel="prev" title="Import data" href="import.html" />
</head>
<body class="data/patches">
    <div id="blacktop"></div>
    <header id="masthead">
      <div class="navbar">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://geogig.org"><h1>GeoGig</h1></a>
          </div>
          <div class="navbar-collapse collapse navbar-right">
            <ul class="nav navbar-nav">
              <li><a href="http://geogig.org/#install">Get Started</a></li>
              <li><a href="http://geogig.org/docs/index.html">Documentation</a></li>
              <li><a href="https://github.com/boundlessgeo/GeoGit">On Github</a></li>
            </ul>
          </div><!--/.navbar-collapse -->
        </div>
      </div>
    </header>

    <section class="subheading hidden-xs">
      <div class="container">
        <div class="row">
          <div class="col-md-8">
            <p class="byline">A Tool for Geospatial Data Management</p>
          </div>
        </div>
      </div>
    </section>
    <a name="top"></a>

 <div id="main">
    <div class="wrap selfclear">
      <div id="content">
      <div class="container">
        <div class="row row-offcanvas row-offcanvas-right">
          <div class="col-md-8"> 
            <div class="row pull-right">
             <div class="visible-sm visible-xs" id="menu-btn">
                <button class="btn btn-blue btn-sm"type="button" data-toggle="offcanvas">
                  <span class="btn-text active">Menu &rarr;</span>
                  <span class="btn-back">&larr; Back</span>
                </button>
              </div>
            </div>
<ul id="breadcrumbs">
  
  <li><a href="../index.html">GeoGig 0.11 User Manual</a> &raquo;</li>
  <li><a href="index.html" accesskey="U">Data and commits</a> &raquo;</li>
  <li>Creating and applying patches</li>
</ul>
<ul id="relatedlinks" class="selfclear">
  <li class="first">
    <a href="../genindex.html" title="General Index"
       accesskey="I">index</a></li>
  <li>
    <a href="picking.html" title="Cherry-picking commits"
       accesskey="N">next</a>|</li>
  <li>
    <a href="import.html" title="Import data"
       accesskey="P">previous</a>|</li>
</ul>
        
  <div class="section" id="creating-and-applying-patches">
<span id="patches"></span><h1>Creating and applying patches<a class="headerlink" href="#creating-and-applying-patches" title="Permalink to this headline">¶</a></h1>
<p>Patches are files that store all the differences that exists between two states A and B of a repository. Patches can be applied to another repository, to alter it based on those differences. Since patches are self-contained, a patch can be created to store a set of changes, sent and applied on a different repository, so this second repository will see those changes reflected in its working tree.</p>
<p>GeoGig patches are created using the <tt class="docutils literal"><span class="pre">format-patch</span></tt> command. The syntax of this command is similar to the <tt class="docutils literal"><span class="pre">diff</span></tt> command. Instead of being printed, differences are written to a patch file, which has to be defined using the <tt class="docutils literal"><span class="pre">-f</span></tt> option. The following example shows the most basic usage</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig format-patch -f changes.patch
</pre></div>
</div>
<p>This will create a patch file named <tt class="docutils literal"><span class="pre">changes.patch</span></tt>, which contains the differences between the index and the current working tree.</p>
<p>To store the differences that correspond to a single path named <tt class="docutils literal"><span class="pre">roads</span></tt>, the following command line should be used.</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig format-patch -f changes.path -- roads
</pre></div>
</div>
<p>Once the patch is created, it can be applied using the <tt class="docutils literal"><span class="pre">apply</span></tt> command. To apply the patch created in the previous example, the following command should be executed.</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig apply changes.patch
</pre></div>
</div>
<p>If the patch can be applied, the working tree will be changed according to the differences stored in the patch. If not, GeoGig will inform the user that the patch cannot be applied.</p>
<p>A patch can be applied onto the working tree of a repository, if it meets the following conditions:</p>
<ul class="simple">
<li>Features to be added do not previously exist on the working tree</li>
<li>Features to be removed already exist on the working tree</li>
<li>Features to be modified already exist on the working tree</li>
<li>If the modification involves changing the value of a given attribute, the previous value matches the value stored in the patch as old value.</li>
<li>If the modification involves adding a new attribute and to the feature type its corresponding value in the feature, the feature does not have that attribute</li>
<li>If the modification involves removing an attribute, the feature must already contain that attribute.</li>
</ul>
<p>Before applying the patch, we can check that it can be applied on the current index, by running the <tt class="docutils literal"><span class="pre">apply</span></tt> command with the <tt class="docutils literal"><span class="pre">--check</span></tt> modifier</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig apply --check changes.path
</pre></div>
</div>
<p>If the patch cannot be applied, GeoGig will show a list of conflicting changes, along with those ones the can be safely applied, like the one shown next.</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig apply --check changes.patch
Error: Patch cannot be applied

Applicable entries:

M    parks/34    a745eadaeda8ca18b1ff544e1cf429e48d2b2697
perimeter    A    0.016849
area    M    732342.64254    7.430135156027973E-6

Conflicting entries:

M    parks/13    a745eadaeda8ca18b1ff544e1cf429e48d2b2697
perimeter    A    0.009355
area    M    364587.870651    3.700497018144233E-6
</pre></div>
</div>
<p>A summary of all changes included in a patch can be obtained by running the command with the <tt class="docutils literal"><span class="pre">--summary</span></tt> option.</p>
<p>If you want to apply the patch ignoring conflicting changes and just using the ones that are safe to apply, you can use the <tt class="docutils literal"><span class="pre">--reject</span></tt> option. This will not only apply the patch partially, but also generate a new patch file with the same name of the one to apply, adding the <tt class="docutils literal"><span class="pre">.rej</span></tt> suffix. This new patch contains just the rejected changes that could not be applied on the current repository.</p>
<p>Patches can be applied in reverse using the <tt class="docutils literal"><span class="pre">--reverse</span></tt> option. a reversed patch has exactly the opposite effect as the direct patch. Applying a reversed patch after applying the same patch in normal mode will leave the working tree in its original state. For this reason, reversed patches can be used to undo changes. A common case fo that is applying a newer patch that contains the changes of a previous one already applied. The first patch can be applied in reverse to undo changes, and then the most recent patch applied on the original state of the repository.</p>
<p>The <tt class="docutils literal"><span class="pre">--reverse</span></tt> option is compatible with other options of the <tt class="docutils literal"><span class="pre">apply</span></tt> command, so a summary of the reversed patch can be obtained by calling using both options together.</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig --reverse --summary changes.patch
</pre></div>
</div>
<div class="section" id="difference-between-patch-files-and-output-of-diff-command">
<h2>Difference between patch files and output of <tt class="docutils literal"><span class="pre">diff</span></tt> command<a class="headerlink" href="#difference-between-patch-files-and-output-of-diff-command" title="Permalink to this headline">¶</a></h2>
<p>Unlike in the case of using git, redirecting the output of the GeoGig``diff`` command to a file will not create a valid patch that can later be used with the <tt class="docutils literal"><span class="pre">apply</span></tt> command. This is due to the different nature of the data that is handled by GeoGig. The <tt class="docutils literal"><span class="pre">diff</span></tt> command tries to create a human-readable version of the difference, but does not include some information needed to apply the patch, such as full descriptions of features types that are created by the patch, or a full listing of modified coordinates, in case a geometry has been modified.</p>
<p>When describing the content of a patch using the <tt class="docutils literal"><span class="pre">--summary</span></tt> option, the summary is presented in the human-readable version, although in the case of modified geometries the result is not exactly the same one output by the <tt class="docutils literal"><span class="pre">diff</span></tt> command.</p>
<p>The following text corresponds to the summary of a single modification in a patch.</p>
<div class="highlight-python"><div class="highlight"><pre>M    parks/22
parktype    &quot;Garden&quot; -&gt; &quot;Park&quot;
the_geom    0 point(s) deleted, 1 new point(s) added, 3 point(s) moved
</pre></div>
</div>
<p>The corresponding patch content, however, is different, as it can be seen below.</p>
<div class="highlight-python"><div class="highlight"><pre>M       parks/22        6350a6955b124119850f5a6906f70dc02ebb31c9        6350a6955b124119850f5a6906f70dc02ebb31c9
parktype        M       &quot;Garden&quot;        &quot;Park&quot;
the_geom        M       0/1/3   @@ -76,20 +76,20 @@\n 2.30\n+40695\n 3\n-3782\n 9\n+54\n 3\n-01001\n+24\n , -1\n@@ -1783,27 +1783,28 @@\n 2.84\n-25\n+3\n 4\n-62\n+888\n 6\n+9\n 00\n-999\n+885\n  42.2984\n 2718\n@@ -1803,18 +1803,18 @@\n 2984\n-2\n+6488\n 7\n-1\n+3976\n 8\n-304132\n , -1\n@@ -1858,16 +1858,55 @@\n  -122.84\n+467141796014 42.29932750407095, -122.84\n 55347783\n@@ -1941,35 +1941,35 @@\n .845\n-526479\n 16\n+200\n 3\n-3\n+71851\n  42.29\n-81311\n+7\n 4\n-1\n+27\n 3\n+2\n 6\n-92\n+717\n 2, -\n
</pre></div>
</div>
<p>The ouput of the <tt class="docutils literal"><span class="pre">diff</span></tt> command for that same modification will be as show next.</p>
<div class="highlight-python"><div class="highlight"><pre>6350a6... 6350a6... 37d757... e0c9ec...   M  parks/22
parktype: &quot;Garden&quot; -&gt; &quot;Park&quot;
the_geom: -122.8456209953915,42.30337924298179 [-122.84288079012158,42.30337829301001] (-122.84288079012158,42.30406953954324) -122.84062871947361,42.303377484342896 -122.84402124697434,42.29758391876194 [-122.8425462600999,42.29842718304132] (-122.84348886900885,42.29846488739768) -122.84403459217438,42.299849758882665 (-122.84467141796014,42.29932750407095) -122.84553477839586,42.29898797978287 [-122.8455264791633,42.29813114136922] (-122.84516200371851,42.2974273267172) -122.84562615512898,42.29822488745995 -122.84562739414677,42.29869863907225 -122.84562865934777,42.29887914225196 -122.84562746190791,42.29938631374956 -122.84562038858874,42.29949283132804 -122.84562093251843,42.30009514260314 -122.84561954067343,42.300597171392674 -122.84562020542222,42.3019375538702 -122.84562986430872,42.302242481706564 -122.84562420177575,42.3031702527034 -122.84562286340557,42.30323277320125 -122.8456209953915,42.30337924298179 @-122.84070544530037,42.29863971301672 -122.84066916748334,42.298658265906056 -122.84114150211431,42.29917259286536 -122.84175134391927,42.2988708450611 -122.84154879818728,42.298647383830684 -122.84162235642542,42.29829337633362 -122.8412561201354,42.297896172348146 -122.8417060301776,42.29766808625502 -122.8412177383454,42.29741710209413 -122.84103109529498,42.29732116850443 -122.84088785596595,42.29783772129766 -122.8398848619697,42.29795997303185 -122.83999152040946,42.29828853706577 -122.84070544530037,42.29863971301672
</pre></div>
</div>
<p>Since the syntax used for describing differences stored in a patch is similar to that of the <tt class="docutils literal"><span class="pre">diff</span></tt> command -except, as mentioned above, in the case of geometries, where <tt class="docutils literal"><span class="pre">diff</span></tt> shows a full list of all coordinates, while the patch summary just shows the number of affected points-, checking the documentation for the <tt class="docutils literal"><span class="pre">diff</span></tt> command is recommended.</p>
</div>
</div>


      <div class="selfclear pagination-nav">
          <div class="leftwise"><strong>Previous</strong>: <a href="import.html" title="previous chapter">Import data</a></div>
          <div class="rightwise"><strong>Next</strong>: <a href="picking.html" title="next chapter">Cherry-picking commits</a></div>
      </div>
      <p class="centered-text"><a href="#top"><img src="../_static/arrow_up.png" alt="back to top"/></a></p>
      </div><!-- /#content> -->
  <div id="sidebar" class="sidebar-offcanvas contrast col-sm-4 sidebar-offcanvas" id="sidebar" role="navigation">

    <div>
         <form id="quick-search" action="search.html" method="get" style="width: 100%;">
          <fieldset>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" value="Search Documentation&hellip;" size="20" tabindex="3" onblur="if(this.value=='') this.value='Search Documentation&hellip;';" onfocus="if(this.value=='Search Documentation&hellip;') this.value='';" />
          </fieldset>
        </form>


        <div class="btn-group-vertical" id="docs_toc"> 
          <button type="button" class="btn btn-default"><a href="/docs/">User Manual</a></button>
          <button type="button" class="btn btn-default"><a href="/technical/">Technical Manual</a></button>
          <button type="button" class="btn btn-default"><a href="/manpages/">Man Pages</a></button>
          <button type="button" class="btn btn-default"><a href="/workshop/">Workshop</a></button>
      </div>
      <h3 class="pngfix">Table Of Contents</h3>
        <ul>
<li><a class="reference internal" href="#">Creating and applying patches</a><ul>
<li><a class="reference internal" href="#difference-between-patch-files-and-output-of-diff-command">Difference between patch files and output of <tt class="docutils literal"><span class="pre">diff</span></tt> command</a></li>
</ul>
</li>
</ul>

        <div class="section-footer"></div>
      </div>
        <div class="section continue_reading">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="import.html" title="previous chapter">Import data</a></li>
            <li>Next: <a href="picking.html" title="next chapter">Cherry-picking commits</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
          <li><a href="../_sources/data/patches.txt">Show Source</a></li>
        </ul>
        </div>
        <div class="section">
          <h3>License</h3>
          <p>This project is licensed under the <a href="https://github.com/boundlessgeo/GeoGit/blob/master/LICENSE.txt">BSD New License</a>.</p>
        </div>

  </div><!-- /#sidebar -->
  </div><!-- /.wrap> -->
</div>
</div>

</div><!-- /#main -->
    <footer>
      <div class="container">
        <div class="row">
          <div class=""><p class="repo-owner"><a href="https://github.com/boundlessgeo/GeoGit">GeoGig</a> is maintained by <a href="https://github.com/boundlessgeo"><img src="../_static/Boundless_Logo.png" alt="Boundless"></a></p></div>
        </div>
      </div>
    </footer>


  <script type="text/javascript" src="../_static/jquery.js"></script>
  <script type="text/javascript" src="../_static/jquery-migrate-min.js"></script>
  <script type="text/javascript" src="../_static/bootstrap.js" ></script>
  <script type="text/javascript" src="../_static/underscore.js"></script>
  <script type="text/javascript" src="../_static/doctools.js"></script>
  <script type="text/javascript" src="../_static/searchtools.js"></script>
  <script type="text/javascript" src="../searchindex.js"></script>
  <script>
      $(document).ready(function() {

      $('[data-toggle=offcanvas]').click(function(e) {
        e.stopPropagation();
        $('.row-offcanvas').toggleClass('active');
        $('.btn-back').toggleClass('active');
        $('.btn-text').toggleClass('active');
      });
      $('.list-group-item').click(function(e) {
        e.stopPropagation();
        $('.row-offcanvas').toggleClass('active');
        $('.btn-back').toggleClass('active');
        $('.btn-text').toggleClass('active');
      });
    });
  </script>
  <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-3879903-19']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
  </script>
  </body>
</html>
