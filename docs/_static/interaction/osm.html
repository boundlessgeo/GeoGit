<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, maximum-scale=1">
  
  <title>Using GeoGig with OpenStreetMap data &mdash; GeoGig 0.11 User Manual</title>
  <link rel="stylesheet" href="../_static/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="../_static/print.css" type="text/css" media="print" /> 
  <!--[if IE]>
  <link rel="stylesheet" href="../_static/blueprint/ie.css" type="text/css" media="screen, projection" />
  <![endif]-->
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/offcanvas.css" type="text/css" />
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.11',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html'
    };
  </script>
      <link rel="top" title="GeoGig 0.11 User Manual" href="../index.html" />
      <link rel="up" title="Other ways to interact with GeoGig" href="index.html" />
      <link rel="prev" title="Web-Api Documentation" href="web-api.html" />
</head>
<body class="interaction/osm">
    <div id="blacktop"></div>
    <header id="masthead">
      <div class="navbar">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://geogig.org"><h1>GeoGig</h1></a>
          </div>
          <div class="navbar-collapse collapse navbar-right">
            <ul class="nav navbar-nav">
              <li><a href="http://geogig.org/#install">Get Started</a></li>
              <li><a href="http://geogig.org/docs/index.html">Documentation</a></li>
              <li><a href="https://github.com/boundlessgeo/GeoGit">On Github</a></li>
            </ul>
          </div><!--/.navbar-collapse -->
        </div>
      </div>
    </header>

    <section class="subheading hidden-xs">
      <div class="container">
        <div class="row">
          <div class="col-md-8">
            <p class="byline">A Tool for Geospatial Data Management</p>
          </div>
        </div>
      </div>
    </section>
    <a name="top"></a>

 <div id="main">
    <div class="wrap selfclear">
      <div id="content">
      <div class="container">
        <div class="row row-offcanvas row-offcanvas-right">
          <div class="col-md-8"> 
            <div class="row pull-right">
             <div class="visible-sm visible-xs" id="menu-btn">
                <button class="btn btn-blue btn-sm"type="button" data-toggle="offcanvas">
                  <span class="btn-text active">Menu &rarr;</span>
                  <span class="btn-back">&larr; Back</span>
                </button>
              </div>
            </div>
<ul id="breadcrumbs">
  
  <li><a href="../index.html">GeoGig 0.11 User Manual</a> &raquo;</li>
  <li><a href="index.html" accesskey="U">Other ways to interact with GeoGig</a> &raquo;</li>
  <li>Using GeoGig with OpenStreetMap data</li>
</ul>
<ul id="relatedlinks" class="selfclear">
  <li class="first">
    <a href="../genindex.html" title="General Index"
       accesskey="I">index</a></li>
  <li>
    <a href="web-api.html" title="Web-Api Documentation"
       accesskey="P">previous</a>|</li>
</ul>
        
  <div class="section" id="using-geogig-with-openstreetmap-data">
<h1>Using GeoGig with OpenStreetMap data<a class="headerlink" href="#using-geogig-with-openstreetmap-data" title="Permalink to this headline">¶</a></h1>
<p>GeoGig can be used to version OSM data, and also to contribute changes back once the work is done. GeoGig aims to provide all the tools needed for the versioning part of a normal OSM editing workflow, adding some of its powerful tools to give additional possibilites.</p>
<p>This section describes the GeoGig commands that interact with OSM and their usage.</p>
<div class="section" id="importing-osm-data">
<h2>Importing OSM data<a class="headerlink" href="#importing-osm-data" title="Permalink to this headline">¶</a></h2>
<p>Just like you can import data form a shapefile or a PostGIS database into a GeoGig repository, you can also import OSM data from a file in one of the supported OSm formats (OSM XML or pbf). The <tt class="docutils literal"><span class="pre">osm</span> <span class="pre">import</span></tt> is the command to use for that.</p>
<p>The <tt class="docutils literal"><span class="pre">osm</span> <span class="pre">import</span></tt> command has the following syntax:</p>
<div class="highlight-python"><div class="highlight"><pre>geogig osm import &lt;path_to_file&gt;
</pre></div>
</div>
<p>Both OSM XML and pbf formats are supported.</p>
<p>Data in the specified file is imported into GeoGig and put into two trees: <tt class="docutils literal"><span class="pre">way</span></tt> and <tt class="docutils literal"><span class="pre">node</span></tt>, with default feature types in both cases. The feature type keeps the data in a way that makes it possible to later recreate the OSM objects and export back to an OSM XML or pbf file, as we will see.</p>
<p>You can see the definition of those feature types by using the <tt class="docutils literal"><span class="pre">show</span></tt> command on both trees.</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig show WORK_HEAD:way
TREE ID:  fb04b79726d7a969393308a3e40fdd47a6c7be4b
SIZE:  5254
NUMBER Of SUBTREES:  0
DEFAULT FEATURE TYPE ID:  03585dd9f1ccd1555372782e6f18bf44ec5d9693

DEFAULT FEATURE TYPE ATTRIBUTES
--------------------------------
changeset: &lt;LONG&gt;
nodes: &lt;STRING&gt;
tags: &lt;STRING&gt;
timestamp: &lt;LONG&gt;
user: &lt;STRING&gt;
version: &lt;INTEGER&gt;
visible: &lt;BOOLEAN&gt;
way: &lt;LINESTRING&gt;


$geogig show WORK_HEAD:node
TREE ID:  98d0b69bab10307921b939aa8ee975e6eb669d17
SIZE:  153503
NUMBER Of SUBTREES:  0
DEFAULT FEATURE TYPE ID:  f63c0dd9d76623e2af985553c94d5219a9c0e2b7

DEFAULT FEATURE TYPE ATTRIBUTES
--------------------------------
changeset: &lt;LONG&gt;
location: &lt;POINT&gt;
tags: &lt;STRING&gt;
timestamp: &lt;LONG&gt;
user: &lt;STRING&gt;
version: &lt;INTEGER&gt;
visible: &lt;BOOLEAN&gt;
</pre></div>
</div>
<p>Here is an example of a way imported into the <tt class="docutils literal"><span class="pre">way</span></tt> tree, as described by the <tt class="docutils literal"><span class="pre">`show</span></tt> command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig show WORK_HEAD:way/31347480

ID:  d81271b7346586c95166c43feb6e91ffe7adb9d5

ATTRIBUTES
----------
changeset: 14220478
nodes: 269237860;2059114068;269237861;278905850;269237862;269237863;278904103;1300224351;269237865;345117527
tags: highway:residential|lit:yes|name:Gielgenstrasse
timestamp: 1355097350000
user: adjuva:92274
version: 5
visible: true
way: LINESTRING (7.1960069 50.7399033, 7.195868 50.7399081, 7.1950788 50.739912, 7.1949262 50.7399053, 7.1942463 50.7398686, 7.1935778 50.7398262, 7.1931011 50.7398018, 7.1929987 50.7398009, 7.1925978, 50.7397889, 7.1924199 50.7397781)
</pre></div>
</div>
<p>As in the case of importing from a shapefile of database, the tree where data is imported is deleted before importing, so the imported data replaces the previous one. In this case, both <tt class="docutils literal"><span class="pre">way</span></tt> and <tt class="docutils literal"><span class="pre">node</span></tt> trees are deleted, even if the imported data does not contain entities of both types. To keep existing data, use the <tt class="docutils literal"><span class="pre">--add</span></tt> switch. Notice that, although existing data will not be deleted, it will be overwritten if the imported data contains entities with the same OSM id.</p>
</div>
<div class="section" id="downloading-data-from-an-osm-server">
<h2>Downloading data from an OSM Server<a class="headerlink" href="#downloading-data-from-an-osm-server" title="Permalink to this headline">¶</a></h2>
<p>A different way of putting OSM data into a GeoGig repository is by connecting to a OSM endpoint that supports the OSM Overpass API. In this case, the <tt class="docutils literal"><span class="pre">osm</span> <span class="pre">download</span></tt> command has to be used instead of <tt class="docutils literal"><span class="pre">osm</span> <span class="pre">import</span></tt></p>
<p>The syntax of the commands is as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>geogig osm download [&lt;server_URL&gt;] [--filter &lt;filter_file&gt;] [--bbox &lt;S&gt; &lt;W&gt; &lt;N&gt; &lt;E&gt;]
</pre></div>
</div>
<p>You can specify the server from which you want to get your OSM data, just entering its URL after the <tt class="docutils literal"><span class="pre">osm</span> <span class="pre">download</span></tt> command. By default, if no URL is provided, the <tt class="docutils literal"><span class="pre">download</span></tt> command uses <tt class="docutils literal"><span class="pre">http://overpass-api.de/api/interpreter</span></tt> as endpoint.</p>
<p>To avoid downloading the full OSM planet, a filter can be used. You should write your filter in a separate text file using the Overpass Query Language. Check the <a class="reference external" href="http://wiki.openstreetmap.org/wiki/Overpass_API/Language_Guide">language documentation</a> to know more about it.</p>
<p>A few considerations to take into account:</p>
<ul>
<li><p class="first">Version information is needed to parse the downloaded data. Use the verbose mode (<tt class="docutils literal"><span class="pre">out</span> <span class="pre">meta;</span></tt>) to get the version information added.</p>
</li>
<li><p class="first">If your filter downloads ways, it should also download the corresponding nodes. For instance, this filter will add no data to your GeoGig repo:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>way
        [&quot;name&quot;=&quot;Gielgenstraße&quot;]
        (50.7,7.1,50.8,7.25);
out meta;
</pre></div>
</div>
<p>The following one, however, will work:</p>
<div class="highlight-python"><div class="highlight"><pre>(
  way
    [&quot;name&quot;=&quot;Gielgenstraße&quot;]
    (50.7,7.1,50.8,7.25);
  &gt;;
);
out meta;
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>If the filter you want to set is just a bounding box filter, you can use the <tt class="docutils literal"><span class="pre">--bbox</span></tt> option as a practical alternative, as in the next example:</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig osm download --bbox 50.7 7.1 50.8 7.25
</pre></div>
</div>
<p>Values after the <tt class="docutils literal"><span class="pre">--bbox</span></tt> option represent South, West, North and East limits, respectively.</p>
<p>Unlike the case of importing from a file, which works similar to the case of importing from a shapefile or database, downloading from OSM has to be performed with a clean index and working tree, and the imported data is not just imported into the working tree, but also staged and commited. This is done to ensure that the commit actually correspond to an OSM changeset, with no further modification, so it can be later identified and used as a reference when performing other tasks agains the OSM planet, such as updating.</p>
</div>
<div class="section" id="updating-osm-data">
<h2>Updating OSM data<a class="headerlink" href="#updating-osm-data" title="Permalink to this headline">¶</a></h2>
<p>If you have downloaded OSM data into your GeoGig repository using the <tt class="docutils literal"><span class="pre">download</span></tt> command, you can easily update it to get the new changes that might have been added in the central OSM planet. To do so, just run the <tt class="docutils literal"><span class="pre">osm</span> <span class="pre">download</span></tt> command with the <tt class="docutils literal"><span class="pre">--update</span></tt> switch and without specifying any filter file.</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig osm download --update
</pre></div>
</div>
<p>As in the case of importing, you can select a URL different to the default one, just entering it after the command.</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig osm download http://overpass.osm.rambler.ru/ --update
</pre></div>
</div>
<p>The filter that you used for the latest import will be used. In case you want to get the most recent OSM data with a different filter, you should run the <tt class="docutils literal"><span class="pre">download</span></tt> command instead as explained before, which will replace the current OSM data in the geogig repository.</p>
<p>The <tt class="docutils literal"><span class="pre">download</span></tt> command with the <tt class="docutils literal"><span class="pre">--update</span></tt> switch is similar to the <tt class="docutils literal"><span class="pre">pull</span></tt> command in a normal repository. It will get the latest version of the OSM data and put it in new temporary branch. That branch starts at the commit where you made your last update. From that point GeoGig will try to merge that branch with your current branch, doing it the usual way. If you have edited your OSM and your changes are not compatible with the changes introduced in the latest snapshot that you you have just downloaded, conflicts will be signaled, and you should resolve them.</p>
<p>As in the case of the <tt class="docutils literal"><span class="pre">pull</span></tt> command, you can tell GeoGig to perform a rebase instead of a merge, by using the <tt class="docutils literal"><span class="pre">--rebase</span></tt> switch.</p>
</div>
<div class="section" id="exporting-to-osm-formats">
<h2>Exporting to OSM formats<a class="headerlink" href="#exporting-to-osm-formats" title="Permalink to this headline">¶</a></h2>
<p>The content of a GeoGig repository can be exported in OSM XML format, much in the same way as it works for other formats such as shapefiles. The OSM export command has the following format:</p>
<div class="highlight-python"><div class="highlight"><pre>geogig osm export &lt;file&gt; [commitish]
</pre></div>
</div>
<p>If the file has the <tt class="docutils literal"><span class="pre">pbf</span></tt> extension, the created file will be a pbf file. Otherwise, it will be an OSM XML file.</p>
<p>The area to export can be restricted by using the <tt class="docutils literal"><span class="pre">--b</span></tt> option, which works just as it does in the case of the <tt class="docutils literal"><span class="pre">download</span></tt> command. Use it to define a bounding box, and only those elements intersecting the selected area will be exported.</p>
<p>Data exported is taken from the &#8220;way&#8221; and &#8220;node&#8221; trees, and assumed to use the corresponding default feature types. In other words, it assumes OSM data in your repository has been imported either by using the <tt class="docutils literal"><span class="pre">osm</span> <span class="pre">import</span></tt> or <tt class="docutils literal"><span class="pre">osm</span> <span class="pre">download</span></tt> commands. Data in other trees in the repository will not be imported, even if it originated from OSM data and even uses the same feature type, since there is no way for GeoGig to know about it. You will notice that, for this reason, there is no path option in the syntax of the command, since the paths from which to export data are not configurable, and GeoGig uses the default OSM paths.</p>
<p>By default, the data at HEAD is exported. You can export from a different snapshot by entering the commit reference after the export file path.</p>
<p>For instance:</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig export myexportedfile.pbf HEAD~3
</pre></div>
</div>
<p>OSM formats should be used as a part of a normal OSM workflow, both for importing and exporting. If you plan to edit your data and create new versions in your GeoGig repository that you can later contribute back to the OSM planet, either the OSM XML format or the pbf format have to be used. Other formats will not guarantee that the relation between nodes and ways is kept, and the result of a workflow might result in a new snapshot in the GeoGig repository that cannot be later exported and contributed back to the OSM planet.</p>
<p>The geometry of ways is not used to export, and it is assumed to match the set of nodes that are kept in the <tt class="docutils literal"><span class="pre">nodes</span></tt> attribute. That&#8217;s the reason why the OSM formats should be used instead of other formats when exporting OSM data. Using other formats can lead to unconsistent relations between nodes and ways.</p>
<p>In short, you should use <tt class="docutils literal"><span class="pre">osm</span> <span class="pre">export</span></tt> to export your OSM data, and not commands such as <tt class="docutils literal"><span class="pre">pg</span> <span class="pre">export</span></tt> or <tt class="docutils literal"><span class="pre">shp</span> <span class="pre">export</span></tt>.</p>
<p>To be able to use a shapefile or a PostGIS database for working with OSM data, GeoGig provides additional export commands and data mapping functionalities that will be explained later in this chapter. For now, just remember that the usual export commands are not a good idea in case you want to edit and reimport your OSM data.</p>
</div>
<div class="section" id="exporting-differences-as-changesets">
<h2>Exporting differences as changesets<a class="headerlink" href="#exporting-differences-as-changesets" title="Permalink to this headline">¶</a></h2>
<p>The differences between two commits in a repository can be exported as an OSM changeset that can be used to contribute those changes to the OSM planet. To export differences as changesets, the following command has to be used:</p>
<div class="highlight-python"><div class="highlight"><pre>geogig osm create-changeset [commit [commit]] -f &lt;changesets_file&gt;
</pre></div>
</div>
<p>The syntax is similar to the <tt class="docutils literal"><span class="pre">diff</span></tt> command, but the output will be saved to the specified file instead of printed on the console. The two commits are optional, and allow to select the snapshots to compare, with the same meaning as the equivalent parameters in the <tt class="docutils literal"><span class="pre">diff</span></tt> command.</p>
<p>To export the differences between the working tree and the current HEAD, this would be the command line to use:</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig osm create-changeset -f changeset.xml
</pre></div>
</div>
<p>Only the <tt class="docutils literal"><span class="pre">node</span></tt> and <tt class="docutils literal"><span class="pre">way</span></tt> trees are compared to find the differences between the specified commits. Changes in other trees will be ignored, and no changeset entries will be created based on them.</p>
<p>The changeset command accepts an addtional parameter <tt class="docutils literal"><span class="pre">--id</span></tt>. In case the OSM trees contain modified or new feature which do not have a changeset id assigned (because they haven&#8217;t been already uploaded to the OSM planet), they will have a negative changeset id to indicate that. If you pass an Id (which you have to retrieve manually from the OSM planet), GeoGig will use it to replace those negative Ids. This way, you will get a changeset file that is already prepared to be uploaded and contributed to OSM.</p>
</div>
<div class="section" id="data-mapping">
<h2>Data mapping<a class="headerlink" href="#data-mapping" title="Permalink to this headline">¶</a></h2>
<p>Apart from importing the data in the default &#8220;node&#8221; and &#8220;way&#8221; trees, OSM data can also be imported in any given tree, and a custom schema can be used for the corresponding features. This is done using a data mapping. A data mapping is a set of rules, each of them defines the data to map into a given tree. Each mapping rule contains the following elements.</p>
<ul class="simple">
<li>A destination tree.</li>
<li>A set of characteristics of the entities to import onto that tree, which are used as a filter over the whole OSM dataset in the Geogig repository</li>
<li>A set of attributes for the feature type to use. Value of those attributes will be taken from the tags of the same name, if present.</li>
</ul>
<p>Mappings are defined in a mapping file, using JSON syntax, as in the following example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&quot;rules&quot;</span><span class="p">:[</span>
  <span class="p">{</span>
    <span class="s">&quot;name&quot;</span><span class="p">:</span><span class="s">&quot;onewaystreets&quot;</span><span class="p">,</span>
    <span class="s">&quot;filter&quot;</span><span class="p">:{</span>
      <span class="s">&quot;oneway&quot;</span><span class="p">:[</span><span class="s">&quot;yes&quot;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s">&quot;exclude&quot;</span><span class="p">:{</span>
      <span class="s">&quot;highway&quot;</span><span class="p">:[</span><span class="s">&quot;construction&quot;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s">&quot;fields&quot;</span><span class="p">:{</span>
      <span class="s">&quot;highway&quot;</span><span class="p">:{</span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="s">&quot;highway&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">:</span><span class="s">&quot;STRING&quot;</span><span class="p">},</span>
      <span class="s">&quot;geom&quot;</span><span class="p">:{</span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="s">&quot;geom&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">:</span><span class="s">&quot;LINESTRING&quot;</span><span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]}</span>
</pre></div>
</div>
<p>A mapping description is an array of mapping rules, each of them with the following fields:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">name</span></tt> defines the name of the mapping, and is used as the name of the destination tree.</li>
<li><tt class="docutils literal"><span class="pre">filter</span></tt> is a set of tags and values, which define the entities to use for the tree. All entities which have any of the specified values for any of the given tags will be used. And empty filter will cause all entities to be used.</li>
<li><tt class="docutils literal"><span class="pre">exclude</span></tt> is a set of tags and values used to exclude certain elements. Those elements that contain any of the specified values for the specified tags, will not be mapped, even if they pass the filter set by the <tt class="docutils literal"><span class="pre">filter</span></tt> element. This field can be ignored and not added to the JSON definition, so no exclusion filter is added. Examples in this document do not use this field.</li>
<li><tt class="docutils literal"><span class="pre">fields</span></tt> is a set of tags and destination column names and types.</li>
<li><tt class="docutils literal"><span class="pre">defaultFields</span></tt> is a list of default fields to be added from the original OSM feature, without transformation. It is an optional entry and can be ommitted.</li>
</ul>
<p>The following mapping will copy all ways to a feature type that only contains the geometry of the way:</p>
<div class="highlight-python"><div class="highlight"><pre>  {&quot;rules&quot;:[
    {
&quot;name&quot;:&quot;all_ways&quot;,
      &quot;filter&quot;:{},
      &quot;fields&quot;:{
        &quot;geom&quot;:{&quot;name&quot;:&quot;geom&quot;,&quot;type&quot;:&quot;LINESTRING&quot;}
      }
    }
  ]}
</pre></div>
</div>
<p>To get all the entities that have a given tag, independently of the tag value, use an empty list for the accepted values. For instance, to get all the nodes with the tag <tt class="docutils literal"><span class="pre">power</span></tt> (can be <tt class="docutils literal"><span class="pre">power=tower</span></tt>, <tt class="docutils literal"><span class="pre">power=pole</span></tt>, etc.), use the following mapping:</p>
<div class="highlight-python"><div class="highlight"><pre>  {&quot;rules&quot;:[
    {
&quot;name&quot;:&quot;power&quot;,
      &quot;filter&quot;:{
        &quot;power&quot;:[]
      },
      &quot;fields&quot;:{
        &quot;geom&quot;:{&quot;name&quot;:&quot;geom&quot;, &quot;type&quot;:&quot;POINT&quot;},
        &quot;power&quot;:{&quot;name&quot;:&quot;powertype&quot;, &quot;type&quot;:&quot;STRING&quot;}
      }
    }
  ]}
</pre></div>
</div>
<p>Any way/node that matches any of the supplied filters will pass through the rule. For instance, to get a subset of buildings and air terminals (a special case of building) use:</p>
<p>You can make tags mandatory by adding them to the exclude section, with a <tt class="docutils literal"><span class="pre">null</span></tt> value. That will exclude all elements that do not have the tag, instead of the ones that have it or have a specific value for it.</p>
<dl class="docutils">
<dt>::</dt>
<dd><dl class="first docutils">
<dt>{&#8220;rules&#8221;:[</dt>
<dd><dl class="first docutils">
<dt>{</dt>
<dd><p class="first">&#8220;name&#8221;:&#8221;namedhighways&#8221;,
&#8220;filter&#8221;:{</p>
<blockquote>
<div>&#8220;highway&#8221;:[]</div></blockquote>
<p>},
&#8220;exclude&#8221;:{</p>
<blockquote>
<div>&#8220;name&#8221;:null</div></blockquote>
<p>},
&#8220;fields&#8221;:{</p>
<blockquote>
<div>&#8220;geom&#8221;:{&#8220;name&#8221;:&#8221;geom&#8221;,&#8221;type&#8221;:&#8221;POINT&#8221;}</div></blockquote>
<p class="last">}</p>
</dd>
</dl>
<p class="last">}</p>
</dd>
</dl>
<p class="last">]}</p>
</dd>
</dl>
<p>That mapping will match all highways, except those that do not have a name. Only the geometry is used and no tags are added to the mapped feature.</p>
<div class="highlight-python"><div class="highlight"><pre>      {&quot;rules&quot;:[
  {
    &quot;name&quot;:&quot;buildings&quot;,
    &quot;filter&quot;:{
      &quot;building&quot;:[&quot;residential&quot;,&quot;house&quot;,&quot;garage&quot;,&quot;detached&quot;,&quot;terrace&quot;,&quot;apartments&quot;],
      &quot;aeroway&quot;:[&quot;terminal&quot;]
    },
    &quot;fields&quot;:{
      &quot;geom&quot;:{&quot;name&quot;:&quot;way&quot;,&quot;type&quot;:&quot;POLYGON&quot;},
      &quot;building&quot;:{&quot;name&quot;:&quot;building&quot;, &quot;type&quot;:&quot;STRING&quot;},
      &quot;aeroway&quot;:{&quot;name&quot;:&quot;aeroway&quot;, &quot;type&quot;:&quot;STRING&quot;}
    }
  }
}
</pre></div>
</div>
<p>The format of the <tt class="docutils literal"><span class="pre">fields</span></tt> entries is a little tricky: the initial key is the tag to read from, and the value is a hash giving the field name and field type to write to. So: <tt class="docutils literal"><span class="pre">&quot;my_tag&quot;:{&quot;name&quot;:&quot;my_field&quot;,</span> <span class="pre">&quot;type&quot;:&quot;FIELD_TYPE&quot;}</span></tt></p>
<p>Usually, <tt class="docutils literal"><span class="pre">my_tag</span></tt> and <tt class="docutils literal"><span class="pre">my_field</span></tt> will be identical, so the name of the tag is used as the field name. However, you can use a different name for the field, which will act as an alias for the tag.</p>
<p>Valid types for the <tt class="docutils literal"><span class="pre">FIELD_TYPE</span></tt> are</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">BOOLEAN</span></tt></li>
<li><tt class="docutils literal"><span class="pre">INTEGER</span></tt></li>
<li><tt class="docutils literal"><span class="pre">FLOAT</span></tt></li>
<li><tt class="docutils literal"><span class="pre">DOUBLE</span></tt></li>
<li><tt class="docutils literal"><span class="pre">LONG</span></tt></li>
<li><tt class="docutils literal"><span class="pre">SHORT</span></tt></li>
<li><tt class="docutils literal"><span class="pre">POINT</span></tt></li>
<li><tt class="docutils literal"><span class="pre">LINESTRING</span></tt></li>
<li><tt class="docutils literal"><span class="pre">POLYGON</span></tt></li>
<li><tt class="docutils literal"><span class="pre">STRING</span></tt></li>
<li><tt class="docutils literal"><span class="pre">DATE</span></tt></li>
</ul>
<p>Each tree has only one geometry type, so the geometry type you choose to write out will act as an implicit filter: if you use a field of type <tt class="docutils literal"><span class="pre">POINT</span></tt>, only nodes will be read; if you use a field of type <tt class="docutils literal"><span class="pre">LINESTRING</span></tt> or <tt class="docutils literal"><span class="pre">POLYGON</span></tt>, only ways will be read. When you use a field of type <tt class="docutils literal"><span class="pre">POLYGON</span></tt> all ways will be read and automatically closed. In case you want to be more restrictive about how to create a polygon, you can use the <tt class="docutils literal"><span class="pre">filter</span></tt> entry to define the criteria for a way to be suitable for creating a polygon, such as, for instance, requiring the <tt class="docutils literal"><span class="pre">area=yes</span></tt> or <tt class="docutils literal"><span class="pre">building=yes</span></tt> tag/value pair.</p>
<p>An additional <tt class="docutils literal"><span class="pre">geom```tag</span> <span class="pre">can</span> <span class="pre">be</span> <span class="pre">used</span> <span class="pre">with</span> <span class="pre">two</span> <span class="pre">possible</span> <span class="pre">values:</span> <span class="pre">``open</span></tt> and <tt class="docutils literal"><span class="pre">closed</span></tt>. Instead of looking for an OSM tag named <tt class="docutils literal"><span class="pre">geom</span></tt>, this will appply the filter to the geometry itself. If the value used is <tt class="docutils literal"><span class="pre">open</span></tt> then only open lines will be used to create the destination geometry (usually a line in this case). If <tt class="docutils literal"><span class="pre">closed</span></tt> is used, only those ways with the end point identical to the start point will be transformed, and the remaining ones ignored.</p>
<p>Notice that, although only one of the above values can be used, it has to be put in a list, as it happens with other tag values in the <tt class="docutils literal"><span class="pre">filter</span></tt> entry. Here is an example that shows how to restrict the ways used to create polygons to just those that have a closed linestring.</p>
<div class="highlight-python"><div class="highlight"><pre>      {&quot;rules&quot;:[
  {
    &quot;name&quot;:&quot;buildings&quot;,
    &quot;filter&quot;:{
      &quot;geom&quot;:[&quot;closed&quot;],
      &quot;building&quot;:[&quot;residential&quot;,&quot;house&quot;,&quot;garage&quot;,&quot;detached&quot;,&quot;terrace&quot;,&quot;apartments&quot;],
      &quot;aeroway&quot;:[&quot;terminal&quot;]
    },
    &quot;fields&quot;:{
      &quot;geom&quot;:{&quot;name&quot;:&quot;way&quot;,&quot;type&quot;:&quot;POLYGON&quot;},
      &quot;building&quot;:{&quot;name&quot;:&quot;building&quot;, &quot;type&quot;:&quot;STRING&quot;},
      &quot;aeroway&quot;:{&quot;name&quot;:&quot;aeroway&quot;, &quot;type&quot;:&quot;STRING&quot;}
    }
  }
}
</pre></div>
</div>
<p>Apart from the fields that you add to the feature type in your mapping definition, GeoGig will always add an <tt class="docutils literal"><span class="pre">id</span></tt> field with the OSM Id of the entity. This is used to track the Id and allow for unmapping, as we will later see. In the case of ways, another field is added, <tt class="docutils literal"><span class="pre">nodes</span></tt>, which contains the Id&#8217;s of nodes that belong to the way. You should avoid using <tt class="docutils literal"><span class="pre">id</span></tt> or <tt class="docutils literal"><span class="pre">nodes</span></tt> as names of your fields, as that might cause problems.</p>
<p>You can also add fields from the original OSM feature without doing any transformation. To do so, add the names of the fields to add in a list in the <tt class="docutils literal"><span class="pre">defaultFields</span></tt> entry.</p>
<p>The following fields are available. Notice that the names are case-sensitive an have to be in lower case.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">timestamp</span></tt></li>
<li><tt class="docutils literal"><span class="pre">changeset</span></tt></li>
<li><tt class="docutils literal"><span class="pre">tags</span></tt></li>
<li><tt class="docutils literal"><span class="pre">user</span></tt></li>
<li><tt class="docutils literal"><span class="pre">visible</span></tt></li>
<li><tt class="docutils literal"><span class="pre">version</span></tt></li>
</ul>
<p>Here&#8217;s an example of using the <tt class="docutils literal"><span class="pre">defaultFields</span></tt> entry in the JSON definition. This mapping will add the fields containing the changeset and timestamp of each feature, copying the corresponding value in the original OSM feature, without any transformation.</p>
<blockquote>
<div><blockquote>
<div><blockquote>
<div>{&#8220;rules&#8221;:[</div></blockquote>
<dl class="docutils">
<dt>{</dt>
<dd><p class="first">&#8220;name&#8221;:&#8221;buildings&#8221;,
&#8220;filter&#8221;:{</p>
<blockquote>
<div>&#8220;building&#8221;:[&#8220;residential&#8221;,&#8221;house&#8221;,&#8221;garage&#8221;,&#8221;detached&#8221;,&#8221;terrace&#8221;,&#8221;apartments&#8221;],
&#8220;aeroway&#8221;:[&#8220;terminal&#8221;]</div></blockquote>
<p>},
&#8220;fields&#8221;:{</p>
<blockquote>
<div>&#8220;geom&#8221;:{&#8220;name&#8221;:&#8221;way&#8221;,&#8221;type&#8221;:&#8221;POLYGON&#8221;},
&#8220;building&#8221;:{&#8220;name&#8221;:&#8221;building&#8221;, &#8220;type&#8221;:&#8221;STRING&#8221;},
&#8220;aeroway&#8221;:{&#8220;name&#8221;:&#8221;aeroway&#8221;, &#8220;type&#8221;:&#8221;STRING&#8221;}</div></blockquote>
<p class="last">},
&#8220;defaultFields&#8221;:[&#8220;timestamp&#8221;, &#8220;changeset&#8221;]</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">[Explain this better and in more in detail]</p>
</div>
<p>A mapping file can be used in three different cases.</p>
<ul class="simple">
<li>When importing OSM data using the <tt class="docutils literal"><span class="pre">osm</span> <span class="pre">import</span></tt> or <tt class="docutils literal"><span class="pre">osm</span> <span class="pre">download</span></tt> commands. In both cases, the <tt class="docutils literal"><span class="pre">--mapping</span></tt> option has to be used, followed by the name of the file where the mapping is found, as in the following example.</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>$ geogig osm import fiji-latest.osm.pbf --mapping mymapping.txt
</pre></div>
</div>
<p>Data will be imported in the usual <tt class="docutils literal"><span class="pre">way</span></tt> and <tt class="docutils literal"><span class="pre">node</span></tt> trees with the corresponding default feature types, but also in the trees defined by the mapping, and according to the filter and feature types that it defines.</p>
<p>If you do not want the imported data to be added in <em>raw</em> format in the default trees, you can use the <tt class="docutils literal"><span class="pre">--no-raw</span></tt> switch.</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig osm import fiji-latest.osm.pbf --mapping mymapping.txt --no-raw
</pre></div>
</div>
<p>This option is only available for the <tt class="docutils literal"><span class="pre">osm</span> <span class="pre">import</span></tt> command, but not for the <tt class="docutils literal"><span class="pre">osm</span> <span class="pre">download</span></tt> command, since the <em>raw</em> data is needed to later be able to perform operations such as update.</p>
<p>Be aware that, when you import using the <tt class="docutils literal"><span class="pre">--no-raw</span></tt> switch, you will not be able to use OSM operations on the imported data, since GeoGig will not consider it as OSM data. When using a mapping, the mapped data is an additional version of the data that is imported in a different tree to give a more practical alternative to the <em>raw</em> one, but that data is not guaranteed to have the necessary information to be able to reconstruct OSM entities. In short, GeoGig will not track data other than the data stored in the <tt class="docutils literal"><span class="pre">way</span></tt> and <tt class="docutils literal"><span class="pre">node</span></tt> trees as OSM data, so you should not to use the <tt class="docutils literal"><span class="pre">--no-raw</span></tt> switch if you plan to do OSM-like work on the imported data.</p>
<p>if <tt class="docutils literal"><span class="pre">--mapping</span></tt> is used and the <tt class="docutils literal"><span class="pre">--no-raw</span></tt> switch is not, the working tree and index have to be clean, and after the import and mapping, a commit will be made (just like when you use the <tt class="docutils literal"><span class="pre">download</span></tt> command, eve without mapping). This is done to allow GeoGig to keep track of mappings, so then the unmmaping operations can provide additional functionality. The comit message is automatically generated, but if you want to define your own message, you can do it using the <tt class="docutils literal"><span class="pre">--message</span></tt> option</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig osm import fiji-latest.osm.pbf --mapping mymapping.txt -message &quot;import and map Fiji data&quot;
</pre></div>
</div>
<ul class="simple">
<li>With already imported OSM data. If you imported OSM data without a mapping, you can apply it afterwards by using the <tt class="docutils literal"><span class="pre">osm</span> <span class="pre">map</span></tt> command followed by the mapping file, as in the example below.</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>$ geogig osm map mymapping.txt
</pre></div>
</div>
<p>Also in this case, as mentioned above, a commit will be created after the mapping, and the working tree and index have to be clean before performing the mapping operation. The <tt class="docutils literal"><span class="pre">--message</span></tt> option can be used as well to set a given commit message.</p>
<p>When exporting OSM data. OSM data can be exported to OSM formats using the <tt class="docutils literal"><span class="pre">osm</span> <span class="pre">export</span></tt> command, and also to other formats using commands such as <tt class="docutils literal"><span class="pre">shp</span> <span class="pre">export</span></tt> or <tt class="docutils literal"><span class="pre">pg</span> <span class="pre">export</span></tt>. In these two last cases, the feature type created in the destination file or database is the same one used it the <tt class="docutils literal"><span class="pre">way</span></tt> or <tt class="docutils literal"><span class="pre">node</span></tt> tree. That is, the default one used for storing the <em>raw</em> OSM data in GeoGig. Additional commands are available to export a mapped set of features.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">osm</span> <span class="pre">export-shp</span></tt>. Export to a shapefile</li>
<li><tt class="docutils literal"><span class="pre">osm</span> <span class="pre">export-pg</span></tt>. Export to a PostGIS database</li>
<li><tt class="docutils literal"><span class="pre">osm</span> <span class="pre">export-sl</span></tt>. Export to a Spatialite database.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">only shp and pg export currently implemented</p>
</div>
<p>These commands all have a syntax similar to the equivalent export commands such as <tt class="docutils literal"><span class="pre">shp</span> <span class="pre">export</span></tt> or <tt class="docutils literal"><span class="pre">pg</span> <span class="pre">export</span></tt>, but without the <tt class="docutils literal"><span class="pre">--alter</span></tt>, <tt class="docutils literal"><span class="pre">--defaulttype</span></tt> and <tt class="docutils literal"><span class="pre">--featuretype</span></tt> options. Instead, the <tt class="docutils literal"><span class="pre">--mapping</span></tt> option must be used to specify the file that contains the mapping to use. Also, a path cannot be specified, since the operation will always take the OSM data from the default <em>raw</em> locations at the <tt class="docutils literal"><span class="pre">way</span></tt> and <tt class="docutils literal"><span class="pre">node</span></tt> trees.</p>
<p>Below you can see some examples:</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig osm export-shp ./myexportfile.shp --mapping ./mymappingfile.json

$ geogig osm export-pg --port 54321 --database geogig --mapping ./mymappingfile.json --user geogig --password geogig
</pre></div>
</div>
<p>When exporting to a shapefile, the mapping file should contain a single rule. If the mapping contains more than one mapping rule, only the first one will be used.</p>
<p>In the case of a shapefile, the destination file has to be entered. In the case of a database export, the name of the each rule is used as the name of the corresponding table to create. In both cases, the <tt class="docutils literal"><span class="pre">--overwrite</span></tt> switch has to be used if the destination file/table already exists.</p>
<p>Since features in a shapefiles must have a geometry, the mapping used when exporting to a shapefile must contain one, and only one, field of type <tt class="docutils literal"><span class="pre">POLYGON,</span> <span class="pre">LINESTRING</span></tt> or <tt class="docutils literal"><span class="pre">POINT</span></tt>. In the case of exporting to a database, the rule can contain no geometry attribute at all.</p>
<p>In all cases, exporting is done from the working tree.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Maybe add an option to select a commitish to export from?</p>
</div>
</div>
<div class="section" id="data-unmapping">
<h2>Data unmapping<a class="headerlink" href="#data-unmapping" title="Permalink to this headline">¶</a></h2>
<p>Mapped OSM data can also be used to modify the original OSM data that is kept in the default <tt class="docutils literal"><span class="pre">node</span></tt> and <tt class="docutils literal"><span class="pre">way</span></tt> trees. This way, you can export your data using a mapping, modifiy that mapped data, reimport it, and then tell GeoGig to reflect those changes back in the original data, which is the one used for all OSM tasks such as generating changesets, remapping to a different feature type, etc.</p>
<p>To unmap the data in a tree in your repository, the <tt class="docutils literal"><span class="pre">osm</span> <span class="pre">unmap</span></tt> command should be used, with the following syntax:</p>
<div class="highlight-python"><div class="highlight"><pre>geogig osm unmap &lt;tree_path&gt;
</pre></div>
</div>
<p>If you add new entities, they will just be added to the corresponding <tt class="docutils literal"><span class="pre">way</span></tt> or <tt class="docutils literal"><span class="pre">node</span></tt> trees. In case the entity already existed, the modified version from you mapped data is merged with the information that is stored in the default location and was not mapped. Those tags that are defined for an entity (and, as such, stored in the <tt class="docutils literal"><span class="pre">way</span></tt> or <tt class="docutils literal"><span class="pre">node</span></tt> trees) but are not used to create attributes in the mapped feature type, are reused when unmapping. Let&#8217;s see it with an example.</p>
<p>For instance, imagine that you have an OSM entity with the following tags</p>
<div class="highlight-python"><div class="highlight"><pre>amenity:fire_station
name:Unnamed fire station
phone:5555986154
</pre></div>
</div>
<p>Let&#8217;s say that you have run the <tt class="docutils literal"><span class="pre">export-pg</span></tt> command to export your nodes to a postGIS database, with the following mapping</p>
<div class="highlight-python"><div class="highlight"><pre>  {&quot;rules&quot;:[
    {
&quot;name&quot;:&quot;firestations&quot;,
      &quot;filter&quot;:{
        &quot;amenity&quot;:[&quot;fire_station&quot;]
      },
      &quot;fields&quot;:{
        &quot;geom&quot;:{&quot;name&quot;:&quot;geom&quot;, &quot;type&quot;:&quot;POINT&quot;},
        &quot;name&quot;:&quot;{&quot;name&quot;:&quot;name&quot;, &quot;type&quot;:&quot;STRING&quot;}
      }
    }
  ]}
</pre></div>
</div>
<p>Basically, you are mapping all fire stations to a new feature type which just contains the station name and its location.</p>
<p>Now, in your exported data, you modified the name of the above firestation from &#8220;Unnamed fire station&#8221; to &#8220;Central fire station&#8221;. After that, you imported the data to a <tt class="docutils literal"><span class="pre">fire_stations</span></tt> tree using the <tt class="docutils literal"><span class="pre">pg</span> <span class="pre">import</span></tt> command.</p>
<p>The <tt class="docutils literal"><span class="pre">firestations</span></tt> tree contains your changes, but the corresponding feature in the <tt class="docutils literal"><span class="pre">node</span></tt> tree is not updated. You can tell GeoGig to update it, by running the unmap command, as shown below.</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig unmap fire_stations
</pre></div>
</div>
<p>The corresponding feature will be updated, and will have the following tags.</p>
<div class="highlight-python"><div class="highlight"><pre>amenity:fire_station
name:Central fire station
phone:5555986154
</pre></div>
</div>
<p>Although the <tt class="docutils literal"><span class="pre">phone</span></tt> tag was not present in the mapped data, it will continue to appear here, since it is taken from the previous version of the feature that was stored in the <tt class="docutils literal"><span class="pre">node</span></tt> tree.</p>
<p>All the work done by the unmap command takes place on the working tree. That is, the mapped path <tt class="docutils literal"><span class="pre">firestations</span></tt> refers to <tt class="docutils literal"><span class="pre">WORK_HEAD:firestations</span></tt>, and the unmapped data is added/replaced in <tt class="docutils literal"><span class="pre">WORK_HEAD:node</span></tt> and <tt class="docutils literal"><span class="pre">WORK_HEAD:way</span></tt>.</p>
<p>In the case of ways, the <tt class="docutils literal"><span class="pre">nodes</span></tt> field will be recomputed based on the geometry. If the geometry has changed and new points have been added to the corresponding line of polygon, new nodes will be added accordingly.</p>
<p>The unmapping operation also considers deleted features, by comparing with the state of your mapped tree just after the last mapping operation (that&#8217;s the reason why a commit is created after mapping, to be able to locate that snapshot). All features that have been deleted from those that existed at that commit just after the mapping was performed, will be deleted from the canonical trees as well. A deleted way will not cause its corresponding nodes to be deleted, but only the canonical representation of the way itself.</p>
</div>
<div class="section" id="an-osm-workflow-using-geogig">
<h2>An OSM workflow using GeoGig<a class="headerlink" href="#an-osm-workflow-using-geogig" title="Permalink to this headline">¶</a></h2>
<p>The following is a short exercise demonstrating how GeoGig can be used as part of a workflow involving OSM data.</p>
<p>First, let&#8217;s initialize the repository.</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig init
</pre></div>
</div>
<p>For this example, we will be working on a small area define by a bounding box. The first step is to get the data corresponding to that area. We will be using a bounding box filtering, which will retrieve all the data within the area, including both ways and nodes.</p>
<p>Run the following command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig osm download --bbox 40 0 40.01 0.01
</pre></div>
</div>
<p>Your OSM data should now be in your GeoGig repository, and a new commit should have been made.</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig log
Commit:  d972aa12d9fdf9ac4192fb81da131e77c3867acf
Author:  volaya &lt;volaya@opengeo.org&gt;
Date:    (4 minutes ago) 2013-06-03 14:37:21 +0300
Subject: Updated OSM data
</pre></div>
</div>
<p>If you want to edit that data and work on it, you can export it using the <tt class="docutils literal"><span class="pre">osm</span> <span class="pre">export</span></tt> command.</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig osm export exported.xml
</pre></div>
</div>
<p>You can open the <tt class="docutils literal"><span class="pre">exported.xml</span></tt> file in a software such as JOSM and edit it. Once it is edited, export it back to an OSM file.</p>
<p>To create a new snapshot in the geogig repository with the edited data, just import the new OSM file.</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig osm import editedWithJosm.xml
</pre></div>
</div>
<p>and then add and commit it</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig add
$ geogig commit -m &quot;Edited OSM data&quot;
[...]
$ geogig log
Commit: a465736fdabc6d6b5a3289499bba695328a6b43c
Author:  volaya &lt;volaya@opengeo.org&gt;
Date:    (15 seconds ago) 2013-05-21 12:37:33 +0300
Subject: Edited OSM data

Commit:  58b84cee8f4817b96804324e83d10c31174da695
Author:  volaya &lt;volaya@opengeo.org&gt;
Date:    (3 minutes ago) 2013-05-21 12:34:30 +0300
Subject: Update OSM to changeset 16215593
</pre></div>
</div>
<p>Another way of editing your data is to export it using a mapping. Let&#8217;s see how to do it.</p>
<p>Create a file named <tt class="docutils literal"><span class="pre">mapping.json</span></tt> in your GeoGig repository folder, with the following content:</p>
<div class="highlight-python"><div class="highlight"><pre>  {&quot;rules&quot;:[
    {
&quot;name&quot;:&quot;power&quot;,
      &quot;filter&quot;:{
        &quot;power&quot;:[&quot;tower&quot;, &quot;pole&quot;]
      },
      &quot;fields&quot;:{
        &quot;coord&quot;:{&quot;name&quot;:&quot;coord&quot;, &quot;type&quot;:&quot;POINT&quot;},
        &quot;power&quot;:{&quot;name&quot;:&quot;power&quot;, &quot;type&quot;:&quot;STRING&quot;}
      }
    }
  ]}
</pre></div>
</div>
<p>Now export the OSM data that you downloaded, using the above mapping.</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig osm export-shp exported.shp --mapping mapping.json
</pre></div>
</div>
<p>The resulting database file can be imported into a desktop GIS such as QGIS. Here&#8217;s how the attributes table of the imported layer would look like:</p>
<div class="figure">
<img alt="../_images/qgis_osm.png" src="../_images/qgis_osm.png" />
</div>
<p>Let&#8217;s edit one of the features in the layer (don&#8217;t worry, we are not going to commit the changes back to OSM, so we can modify it even if the new data is not real). Take the feature with the Id <tt class="docutils literal"><span class="pre">1399057662</span></tt>, move its corresponding point to a different place and change the value of the <tt class="docutils literal"><span class="pre">power</span></tt> attribute from <tt class="docutils literal"><span class="pre">tower</span></tt> to <tt class="docutils literal"><span class="pre">pole</span></tt>.</p>
<p>Save it to the same <tt class="docutils literal"><span class="pre">export.shp</span></tt> file and then import it back into the GeoGig repository using the following command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig shp import export.shp -d power
</pre></div>
</div>
<p>The imported data is now in the <tt class="docutils literal"><span class="pre">power</span></tt> tree.</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig show WORK_HEAD:power
TREE ID:  cd6d05d0fe0c527a78e56ef4ec7439a494a6229c
SIZE:  130
NUMBER Of SUBTREES:  0
DEFAULT FEATURE TYPE ID:  e1833b12c4fc867f10b3558b1b32c33abdd88afa

DEFAULT FEATURE TYPE ATTRIBUTES
--------------------------------
id: &lt;LONG&gt;
power: &lt;STRING&gt;
the_geom: &lt;POINT&gt;
</pre></div>
</div>
<p>The node we have edited is not updated in the <tt class="docutils literal"><span class="pre">node</span></tt> tree, as you can see by running the following command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig show WORK_HEAD:node/1399057662
ID:  9877ef1ed87f5e9e85a00416e681f3a0238725b9

ATTRIBUTES
----------
changeset: 9020582
location: POINT (0.0033643 40.0084599)
tags: power:tower
timestamp: 1313352916000
user: Antonio Eugenio Burriel:24070
version: 1
visible: true
</pre></div>
</div>
<p>To update the data in the &#8220;node&#8221; tree, we can run the <tt class="docutils literal"><span class="pre">osm</span> <span class="pre">unmap</span></tt> command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig osm unmap power
</pre></div>
</div>
<p>Now the node should have been updated.</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig show WORK_HEAD:node/1399057662
ID:  ff6663ccec292fb2c06dcea5ec8b539be9cb50fb

ATTRIBUTES
----------
changeset: Optional.absent()
location: POINT (0.0033307887896529 40.00889554573451)
tags: power:pole
timestamp: 1370271076015
user: Optional.absent()
version: Optional.absent()
visible: true
</pre></div>
</div>
<p>You can now add and commit your changes.</p>
<p>To merge those changes (no matter which one of the above method you have used to edit the OSM data in your GeoGig repository) with the current data in the OSM planet, in case there have been changes, use the <tt class="docutils literal"><span class="pre">update</span></tt> switch.</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig download --update
</pre></div>
</div>
<p>If there are conflicts, the operation will be stopped and you should resolve them as usual. If not, the, changes will merged with the changes you just added when importing the xml file. If there are no changes since the last time you fetched data from the OSM server, no commit will be made, and the repository will not be changed by the update operation.</p>
<p>Finally, you can export the new changes that you have introduced, as a changeset, ready to be contributed to the OSM planet. The commits to compare depend on the workflow that you have followed. In the case above, you can get them by comparing the current HEAD with its second parent, which corresponds to the branch that was created with the changes downloaded in the update operation, in case there were changes (otherwise, there would be no merge operation, since it was not necessary).</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig create-changeset HEAD^2 HEAD -f changeset.xml
</pre></div>
</div>
<p>Or you can just compare your current HEAD to what you had after your first import.</p>
<div class="highlight-python"><div class="highlight"><pre>$ geogig create-changeset 58b84cee8f4 HEAD -f changeset.xml
</pre></div>
</div>
</div>
</div>


      <div class="selfclear pagination-nav">
          <div class="leftwise"><strong>Previous</strong>: <a href="web-api.html" title="previous chapter">Web-Api Documentation</a></div>
      </div>
      <p class="centered-text"><a href="#top"><img src="../_static/arrow_up.png" alt="back to top"/></a></p>
      </div><!-- /#content> -->
  <div id="sidebar" class="sidebar-offcanvas contrast col-sm-4 sidebar-offcanvas" id="sidebar" role="navigation">

    <div>
         <form id="quick-search" action="search.html" method="get" style="width: 100%;">
          <fieldset>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" value="Search Documentation&hellip;" size="20" tabindex="3" onblur="if(this.value=='') this.value='Search Documentation&hellip;';" onfocus="if(this.value=='Search Documentation&hellip;') this.value='';" />
          </fieldset>
        </form>


        <div class="btn-group-vertical" id="docs_toc"> 
          <button type="button" class="btn btn-default"><a href="/docs/">User Manual</a></button>
          <button type="button" class="btn btn-default"><a href="/technical/">Technical Manual</a></button>
          <button type="button" class="btn btn-default"><a href="/manpages/">Man Pages</a></button>
          <button type="button" class="btn btn-default"><a href="/workshop/">Workshop</a></button>
      </div>
      <h3 class="pngfix">Table Of Contents</h3>
        <ul>
<li><a class="reference internal" href="#">Using GeoGig with OpenStreetMap data</a><ul>
<li><a class="reference internal" href="#importing-osm-data">Importing OSM data</a></li>
<li><a class="reference internal" href="#downloading-data-from-an-osm-server">Downloading data from an OSM Server</a></li>
<li><a class="reference internal" href="#updating-osm-data">Updating OSM data</a></li>
<li><a class="reference internal" href="#exporting-to-osm-formats">Exporting to OSM formats</a></li>
<li><a class="reference internal" href="#exporting-differences-as-changesets">Exporting differences as changesets</a></li>
<li><a class="reference internal" href="#data-mapping">Data mapping</a></li>
<li><a class="reference internal" href="#data-unmapping">Data unmapping</a></li>
<li><a class="reference internal" href="#an-osm-workflow-using-geogig">An OSM workflow using GeoGig</a></li>
</ul>
</li>
</ul>

        <div class="section-footer"></div>
      </div>
        <div class="section continue_reading">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="web-api.html" title="previous chapter">Web-Api Documentation</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
          <li><a href="../_sources/interaction/osm.txt">Show Source</a></li>
        </ul>
        </div>
        <div class="section">
          <h3>License</h3>
          <p>This project is licensed under the <a href="https://github.com/boundlessgeo/GeoGit/blob/master/LICENSE.txt">BSD New License</a>.</p>
        </div>

  </div><!-- /#sidebar -->
  </div><!-- /.wrap> -->
</div>
</div>

</div><!-- /#main -->
    <footer>
      <div class="container">
        <div class="row">
          <div class=""><p class="repo-owner"><a href="https://github.com/boundlessgeo/GeoGit">GeoGig</a> is maintained by <a href="https://github.com/boundlessgeo"><img src="../_static/Boundless_Logo.png" alt="Boundless"></a></p></div>
        </div>
      </div>
    </footer>


  <script type="text/javascript" src="../_static/jquery.js"></script>
  <script type="text/javascript" src="../_static/jquery-migrate-min.js"></script>
  <script type="text/javascript" src="../_static/bootstrap.js" ></script>
  <script type="text/javascript" src="../_static/underscore.js"></script>
  <script type="text/javascript" src="../_static/doctools.js"></script>
  <script type="text/javascript" src="../_static/searchtools.js"></script>
  <script type="text/javascript" src="../searchindex.js"></script>
  <script>
      $(document).ready(function() {

      $('[data-toggle=offcanvas]').click(function(e) {
        e.stopPropagation();
        $('.row-offcanvas').toggleClass('active');
        $('.btn-back').toggleClass('active');
        $('.btn-text').toggleClass('active');
      });
      $('.list-group-item').click(function(e) {
        e.stopPropagation();
        $('.row-offcanvas').toggleClass('active');
        $('.btn-back').toggleClass('active');
        $('.btn-text').toggleClass('active');
      });
    });
  </script>
  <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-3879903-19']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
  </script>
  </body>
</html>
